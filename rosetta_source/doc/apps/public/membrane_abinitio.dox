// -*- mode:c++;tab-width:2;indent-tabs-mode:t;show-trailing-whitespace:t;rm-trailing-spaces:t -*-
// vi: set ts=2 noet:
//
// (c) Copyright Rosetta Commons Member Institutions.
// (c) This file is part of the Rosetta software suite and is made available under license.
// (c) The Rosetta software is developed by the contributing members of the Rosetta Commons.
// (c) For more information, see http://www.rosettacommons.org. Questions about this can be
// (c) addressed to University of Washington UW TechTransfer, email: license@u.washington.edu.

///@author Vladimir Yarov-Yarovoy
/*!

@page membrane_abinitio Documentation for membrane ab initio modeling application

@section metadata Metadata
This document was last updated on June 2, 2010 by Vladimir Yarov-Yarovoy <yarovoy@uw.edu>.  The PI is David Baker <dabaker@uw.edu>.
The membrane ab initio application was developed by:

@li Jack Schonbrun
@li Vladimir Yarov-Yarovoy
@li Patrick Barth
@li Bjorn Wallner

@section code_demos Code and Demo
The membrane ab initio executable is in src/apps/public/membrane_abinitio/membrane_abinitio2.cc.
See test/integration/tests/membrane_abinitio directory for an example membrane ab initio run and input files.

@section refs references
@li Barth P, Wallner B, Baker D. (2009 Feb 3) Prediction of membrane protein structures with complex topologies using limited constraints. Proc Natl Acad Sci U S A. 106(5):1409-14.
@li Barth P, Schonbrun J, Baker D. (2007 Oct 2) Toward high-resolution prediction and design of transmembrane helical protein structures. Proc Natl Acad Sci U S A. 104(40):15682-7.
@li Yarov-Yarovoy V, Schonbrun J, Baker D. (2006 Mar 1) Multipass membrane protein structure prediction using Rosetta. Proteins. 62(4):1010-25.

@section purpose  Purpose
This protocol was developed to predict helical membrane protein structures.

@section algorithm Algorithm
This protocol will only generate low-resolution centroid models.  The protocol is using transmembrane region predictions from OCTOPUS server (http://octopus.cbr.su.se/) to set initial membrane normal and membrane center vectors and define membrane-specific environment (hydrophobic core, interface, polar, and water layers). For multispan helical membrane proteins the protocol starts from embedding only two randomly selected adjacent transmembrane helical regions and then continues folding by inserting one of adjacent helices until all transmembrane helices will be embedded into the membrane.

@section inputs Input Files

Membrane ab initio protocol specific input files (BRD4.span and BRD4.lips4 in the above example) are generated using octopus2span.pl, run_lips.pl, and alignblast.pl scripts located in path/to/rosetta/rosetta_source/src/apps/public/membrane_abinitio/ .
Note that blastpgp and nr database are necessary to run run_lips.pl script.

@li BRD4.span - transmembrane topology prediction file generated using octopus2span.pl script as follows:
@verbatim
octopus2span.pl <OCTOPUS topology file>

example: <path to rosetta>/rosetta_source/src/apps/public/membrane_abinitio/octopus2span.pl BRD4.octopus
@endverbatim

Input OCTOPUS topology file is generated at http://octopus.cbr.su.se/ using protein sequence as input.

Sample OCTOPUS topology file:
@verbatim
##############################################################################
OCTOPUS result file
Generated from http://octopus.cbr.su.se/ at 2008-09-18 21:06:32
Total request time: 6.69 seconds.
##############################################################################


Sequence name: BRD4
Sequence length: 123 aa.
Sequence:
PIYWARYADWLFTTPLLLLDLALLVDADQGTILALVGADGIMIGTGLVGALTKVYSYRFV
WWAISTAAMLYILYVLFFGFTSKAESMRPEVASTFKVLRNVTVVLWSAYPVVWLIGSEGA
GIV

OCTOPUS predicted topology:
oooooMMMMMMMMMMMMMMMMMMMMMiiiiMMMMMMMMMMMMMMMMMMMMMooooooMMM
MMMMMMMMMMMMMMMMMMiiiiiiiiiiiiiiiiiiiiiMMMMMMMMMMMMMMMMMMMMM
ooo
@endverbatim

Sample span file:
@verbatim
TM region prediction for BRD4 predicted using OCTOPUS
4 123
antiparallel
n2c
   6    26     6    26
  31    51    31    51
  58    78    58    78
  97   117    97   117
@endverbatim

1st line is comment line.
2nd line shows number of predicted transmembrane helices (4 in the command lines example below) and total number of residues (123 in the example below).
3rd line shows predicted topology of transmembrane helices in the membrane (currently only antiparallel topology is implemented).
4th line and all lines below show start and end residue numbers of each of the predicted transmembrane helices (current format repeats these numbers twice).

@li BRD4.lips4 - lipophilicity prediction file created using run_lips.pl script as follows:
@verbatim
run_lips.pl <fasta file> <span file> <path to blastpgp> <path to nr database> <path to alignblast.pl script>

example: <path to rosetta>/rosetta_source/src/apps/public/membrane_abinitio/run_lips.pl BRD4.fasta BRD4.span /work/bjornw/Apps/blast/bin/blastpgp /scratch/shared/genomes/nr ~bjornw/rosetta/rosetta_source/src/apps/public/membrane_abinitio/alignblast.pl
@endverbatim

Sample lips4 file:
@verbatim
Lipid exposed data: resnum mean-lipo lipophil entropy
      6  -1.000   3.004   1.211
      9  -1.000   2.268   2.137
     10  -1.000   4.862   1.095
     13  -1.000   1.304   1.552
     16  -1.000   3.328   2.025
...
@endverbatim

@li Fragment files
Generate structural fragments only using SAM secondary structure prediction file (*.rdb) - jufo and psipred predict transmembrane helical regions poorly.

@section ft_options Options
You can run membrane ab initio application with the following flags:

@verbatim
./bin/membrane_abinitio2.linuxgccrelease
-in:file:native BRD4.pdb                  Native structure (optional)
(or -in:file:fasta BRD4_.fasta)           Protein sequence in fasta format (required if native structure is not provided)
-in:file:spanfile BRD4.span               Octopus transmembrane prediction (see above)
-in:file:lipofile BRD4.lips4              Lipophilicity prediction (see above)
-in:file:frag3 aaBRD4_03_05.200_v1_3      3-residue fragments
-in:file:frag9 aaBRD4_09_05.200_v1_3      9-residue fragments
-in:path:database ~rosetta_database       Path to rosetta database
-abinitio:membrane                        Membrane ab initio application
-score:find_neighbors_3dgrid              Use a 3D lookup table for residue neighbors calculations
-membrane:no_interpolate_Mpair            Switch off the interpolation between the two layers for the Mpair term
-membrane:Menv_penalties                  Switch on the following penalties:

    * no non-helical secondary structure fragments in predicted transmembrane helical regions in the hydrophobic layer of the membrane.
    * no N- and C- termini residues of predicted transmembrane helical regions in the hydrophobic layer of the membrane.
    * no transmembrane helices with orientation >45 degrees relative to the membrane normal vector.

-nstruct 1                                Number of output structures
@endverbatim

There are several optional settings used for Monte Carlo based membrane normal and center search protocol:
@verbatim
-membrane:normal_cycles (default=100)     Total number of membrane normal cycles
-membrane:normal_mag (default=5)          Magnitude of membrane normal angle search (degrees)
-membrane:center_mag (default=1)          Magnitude of membrane center search (Angstroms)
@endverbatim

For more information about membrane ab initio modeling flags, please check the @ref full_options_list "full options list"

@section tips Tips

Use the following settings to speedup Monte Carlo based membrane normal and center search:

@verbatim
-membrane:normal_cycles 40
-membrane:normal_mag 15
-membrane:center_mag 2
@endverbatim

@section outputs Expected Outputs
Protocol generates pdb files and an energy file.
Membrane ab initio application specific score outputs in the energy file are:

@verbatim
Mpair                         membrane pairwise residue interaction energy
Menv                          membrane residue environment energy
Mcbeta                        membrane residue centroid density energy
Mlipo                         membrane residue lipophilicity energy
Menv_hbond                    membrane non-helical secondary structure in the hydrophobic layer penalty
Menv_termini                  membrane N- and C-temini residue in the hydrophobic layer penalty
Menv_tm_proj                  transmembrane helix projection penalty
@endverbatim

@section postprocess Post Processing

We recommend to generate 10,000 models and then use rosetta Cluster application to identify most frequently sampled conformations.  In general case, at least one of top 5-10 clusters will have models with the lowest rmsd to the native structure.

@section new_stuff_3p2 New Features In Rosetta3.2

Rosetta 3.2 includes new options for exhaustive membrane normal and center search:

@verbatim
-membrane:center_search (default= false) - perform membrane center search within "center_max_delta" deviation (see below).
-membrane:normal_search (default= false) - perform membrane normal search with normal_start_angle, normal_delta_angle, and normal_max_angle values (see below).
-membrane:center_max_delta (default= 5 A) - magnitude of maximum membrane width deviation during membrane center search (Angstroms).
-membrane:normal_start_angle (default= 10 degrees) - magnitude of starting angle during membrane normal search (degrees).
-membrane:normal_delta_angle (default= 10 degrees) - magnitude of angle deviation during membrane normal search (degrees).
-membrane:normal_max_angle (default= 40 degrees) - magnitude of maximum angle deviation during membrane normal search (degrees).
@endverbatim

Note that by default membrane abinitio, membrane score, and membrane relax protocols will still use Monte Carlo based protocol to search membrane center and normal.

*/
