# N-methylation: methyl groups on peptide amide replacing amide proton (in the MIDDLE of a sequence, not at the N-terminus).
# Created by Vikram K. Mulligan (vmullig@uw.edu), Baker laboratory, 7 September 2016.

NAME N_Methylation
TYPES N_METHYLATION

# General requirements for this patch:

BEGIN_SELECTOR
PROPERTY PROTEIN
NOT PROPERTY PEPTOID
NOT PROPERTY LOWER_TERMINUS
NOT PROPERTY PHOSPHONATE
NOT VARIANT_TYPE HBS_PRE 
NOT VARIANT_TYPE HBS_POST
NOT VARIANT_TYPE A3B_HBS_PRE
NOT VARIANT_TYPE A3B_HBS_POST
NOT VARIANT_TYPE ACETYLATED_NTERMINUS_VARIANT
NOT VARIANT_TYPE METHYLATED_NTERM_VARIANT 
NOT VARIANT_TYPE METHYLATED_CTERMINUS_VARIANT
NOT VARIANT_TYPE NTERM_CONNECT
NOT VARIANT_TYPE N_ACETYLATION
NOT VARIANT_TYPE N_FORMYLATION
NOT VARIANT_TYPE LOWER_TERMINUS_VARIANT
NOT VARIANT_TYPE LOWERTERM_TRUNC_VARIANT
NOT VARIANT_TYPE SHOVE_BB
NOT VARIANT_TYPE VIRTUAL_BB
NOT VARIANT_TYPE CUTPOINT_LOWER
NOT VARIANT_TYPE REPLONLY
NOT NAME3 PRO DPR
END_SELECTOR

BEGIN_CASE ### TRP ##########################################

BEGIN_SELECTOR
NAME3 TRP
END_SELECTOR

# Add a methyl group, and delete the amide proton:
ADD_ATOM  CN  CH3   CT3   -0.17
ADD_ATOM 1HN  Hapo  HA    0.014
ADD_ATOM 2HN  Hapo  HA    0.014
ADD_ATOM 3HN  Hapo  HA    0.014
DELETE_ATOM  H

# Define the connectivity of the added atoms:
ADD_BOND  N   CN
ADD_BOND 1HN  CN
ADD_BOND 2HN  CN
ADD_BOND 3HN  CN

# Set the coordinates of the added atoms:
SET_ICOOR  CN  -180.000000   60.849998    1.449020   N     CA   LOWER
SET_ICOOR 1HN   -72.124155   68.240467    1.083554   CN    N     C
SET_ICOOR 2HN   120.381913   70.210033    1.080230   CN    N    1HN
SET_ICOOR 3HN   119.184435   71.274589    1.081917   CN    N    2HN

# Update properties:
ADD_PROPERTY N_METHYLATED

REMOVE_ROTAMER_SPECIFICATIONS
NCAA_ROTLIB_PATH nvl.rotlib #TODO update this to a real rotamer library
NCAA_ROTLIB_NUM_ROTAMER_BINS 2 3 3

END_CASE

BEGIN_CASE ### THE GENERAL CASE ##########################################

# Add a methyl group, and delete the amide proton:
ADD_ATOM  CN  CH3   CT3   -0.17
ADD_ATOM 1HN  Hapo  HA    0.014
ADD_ATOM 2HN  Hapo  HA    0.014
ADD_ATOM 3HN  Hapo  HA    0.014
DELETE_ATOM  H

# Define the connectivity of the added atoms:
ADD_BOND  N   CN
ADD_BOND 1HN  CN
ADD_BOND 2HN  CN
ADD_BOND 3HN  CN

# Set the coordinates of the added atoms:
SET_ICOOR  CN  -180.000000   60.849998    1.449020   N     CA   LOWER
SET_ICOOR 1HN   -72.124155   68.240467    1.083554   CN    N     C
SET_ICOOR 2HN   120.381913   70.210033    1.080230   CN    N    1HN
SET_ICOOR 3HN   119.184435   71.274589    1.081917   CN    N    2HN

# Update properties:
ADD_PROPERTY N_METHYLATED

END_CASE
